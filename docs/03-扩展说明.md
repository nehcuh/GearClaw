# 03 扩展说明

## 1. 扩展地图

GearClaw 的主要扩展点如下：

1. 工具扩展（Tool）  
2. 技能扩展（Skill）  
3. 渠道扩展（Channel Adapter）  
4. 网关协议/方法扩展（Gateway）  
5. 配置扩展（Config）  
6. MCP 能力扩展（未来启用）

## 2. 工具扩展

### 2.1 目标位置

1. 基础执行能力：`crates/tools`  
2. core 侧封装与平台增强：`crates/core/src/tools.rs`  
3. Agent 调度入口：`crates/core/src/agent.rs`

### 2.2 最小步骤

1. 在工具注册列表加入新 `ToolSpec`（名称、描述、参数 schema）  
2. 在 Agent 的 `execute_tool_call` 中增加分支  
3. 确保 security 语义符合现有策略（deny/allowlist/full）  
4. 补充单元测试和文档

## 3. 技能扩展

### 3.1 技能文件规范

技能目录下使用 `SKILL.md`，包含 frontmatter 与正文指令。

### 3.2 最小步骤

1. 在 `agent.skills_path` 下新建技能目录  
2. 放置 `SKILL.md`（含 name/description）  
3. 启动时由 `SkillManager` 自动加载并注入 prompt 上下文

## 4. 渠道扩展

### 4.1 目标接口

实现 `ChannelAdapter` trait：

1. `platform_name`  
2. `start`  
3. `send_message`  
4. `on_message`  
5. `resolve_target`  
6. `health_check`

### 4.2 最小步骤

1. 在 `crates/channels/src/platforms` 新增平台实现  
2. 在 Gateway 启动阶段注册适配器  
3. 确保消息能转换为 `IncomingMessage` 并产出 `channel.message` 事件

## 5. 网关扩展

### 5.1 扩展方法

1. 在 `protocol` 定义参数/返回结构  
2. 在 `handlers` 增加对应处理方法  
3. 在 `server` 路由分发中注册新 method

### 5.2 扩展事件

1. 在 `GatewayEvent` 增加事件类型  
2. 在广播逻辑中补齐触发点与负载结构  
3. 保持客户端向后兼容（避免破坏已存在字段）

## 6. 配置扩展

1. 在 `Config` 中增加字段与默认值  
2. 增加验证逻辑（必要时）  
3. 更新 `Config::sample()` 与文档 `05-配置说明.md`

## 7. MCP 扩展注意点

当前 MCP 能力默认 disabled。  
若启用，应同步完成：

1. 构建能力开关与依赖恢复  
2. 客户端初始化与工具枚举  
3. Agent 中 MCP 工具调用路径联调  
4. 安全策略与故障降级设计

## 8. 扩展落地检查清单

1. 功能代码完成  
2. 配置项与默认值完整  
3. 测试覆盖核心路径  
4. 文档已更新并在 `00-文档索引.md` 登记

## 9. 导航

- 上一篇：[`02-系统设计说明.md`](./02-系统设计说明.md)  
- 下一篇：[`04-快速开始与运行.md`](./04-快速开始与运行.md)
