# 05 配置说明

## 1. 配置文件位置

默认查找顺序：

1. `~/.gearclaw/config.toml`  
2. `$XDG_CONFIG_HOME/gearclaw.toml`（若存在）  
3. `./gearclaw.toml`

## 2. 配置结构

主结构：

1. `llm`  
2. `tools`  
3. `session`  
4. `agent`  
5. `memory`  
6. `mcp`  
7. `gateway`

## 3. 最小可用示例

```toml
[llm]
primary = "gpt-4"
endpoint = "https://api.openai.com/v1"
api_key = ""
embedding_model = "embedding-3"
temperature = 0.7

[tools]
security = "allowlist"
host = "gateway"
profile = "full"
elevated_enabled = false

[session]
session_dir = "~/.gearclaw/sessions"
save_interval = 60
max_tokens = 200000

[agent]
name = "GearClaw"
workspace = "~/.gearclaw/workspace"
memory_enabled = true
skills_path = "~/.gearclaw/skills"

[memory]
enabled = true
db_path = "~/.gearclaw/memory/index.sqlite"

[mcp]
servers = {}

[gateway]
host = "127.0.0.1"
port = 18789
ws_path = "/ws"
allow_unauthenticated_requests = false
```

## 4. 关键字段说明

### 4.1 `tools.security`

1. `deny`：禁用工具调用  
2. `allowlist`：仅允许白名单命令与安全参数  
3. `full`：全量执行能力（需谨慎）

### 4.2 `agent.triggers`

可配置自动响应策略：

1. `mode = "always" | "mention" | "keyword"`  
2. `mention_patterns`  
3. `keywords`  
4. `enabled_channels` / `disabled_channels`

### 4.3 `skill_sources` 与 `skill_trust_policy`

用于技能搜索/安装来源治理，可限定本地来源或仅信任来源。

## 5. 环境变量覆盖

1. `OPENAI_API_KEY`：当配置中未设置 api_key 时使用  
2. `OPENAI_BASE_URL`：当 endpoint 保持默认值时可覆盖  
3. `DISCORD_BOT_TOKEN`：Discord 适配器读取该变量

## 6. 常见配置问题

1. API key 为空导致启动失败  
2. `session_dir` 或 `db_path` 无写权限  
3. `tools.security` 非法值（仅允许 deny/allowlist/full）  
4. 渠道白名单配置格式错误（应为 `platform:channel_id`）

## 7. 导航

- 上一篇：[`04-快速开始与运行.md`](./04-快速开始与运行.md)  
- 下一篇：[`06-网关与频道集成.md`](./06-网关与频道集成.md)
